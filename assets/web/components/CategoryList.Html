<!-- components/CategoryList.html -->
<div class="category-list-container">
    <div class="category-list-header">
        <h2>
            <i class="material-icons">category</i>
            Liste des Catégories
        </h2>
        <button class="btn btn-primary" id="add-category-btn">
            <i class="material-icons">add</i>
            Nouvelle Catégorie
        </button>
    </div>
    
    <div class="category-list-filters">
        <div class="search-box">
            <i class="material-icons">search</i>
            <input type="text" id="category-search" placeholder="Rechercher une catégorie...">
        </div>
        <div class="filter-options">
            <select id="category-filter">
                <option value="all">Toutes les catégories</option>
                <option value="user">Mes catégories</option>
                <option value="system">Catégories système</option>
            </select>
        </div>
    </div>
    
    <div class="category-list-content">
        <div class="loading-state hidden" id="loading-state">
            <div class="spinner"></div>
            <p>Chargement des catégories...</p>
        </div>
        
        <div class="error-state hidden" id="error-state">
            <i class="material-icons">error</i>
            <p id="error-message"></p>
            <button class="btn btn-secondary" id="retry-btn">Réessayer</button>
        </div>
        
        <div class="empty-state hidden" id="empty-state">
            <i class="material-icons">inbox</i>
            <p>Aucune catégorie trouvée</p>
        </div>
        
        <div class="categories-grid" id="categories-grid">
            <!-- Les catégories seront injectées ici -->
        </div>
    </div>
</div>

<style>
.category-list-container {
    background: white;
    border-radius: 12px;
    padding: 24px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
}

.category-list-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 24px;
    padding-bottom: 16px;
    border-bottom: 2px solid #f0f0f0;
}

.category-list-header h2 {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 1.5rem;
    color: #333;
}

#add-category-btn {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px 20px;
}

.category-list-filters {
    display: flex;
    gap: 20px;
    margin-bottom: 24px;
    flex-wrap: wrap;
}

.search-box {
    flex: 1;
    min-width: 250px;
    position: relative;
}

.search-box i {
    position: absolute;
    left: 12px;
    top: 50%;
    transform: translateY(-50%);
    color: #999;
}

.search-box input {
    width: 100%;
    padding: 12px 12px 12px 40px;
    border: 2px solid #e0e0e0;
    border-radius: 8px;
    font-size: 16px;
}

.search-box input:focus {
    outline: none;
    border-color: #ffc107;
}

.filter-options select {
    padding: 12px 20px;
    border: 2px solid #e0e0e0;
    border-radius: 8px;
    font-size: 16px;
    background: white;
    min-width: 200px;
}

.category-list-content {
    min-height: 400px;
}

.loading-state, .error-state, .empty-state {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 60px 20px;
    text-align: center;
}

.loading-state .spinner {
    width: 50px;
    height: 50px;
    margin-bottom: 20px;
}

.error-state i, .empty-state i {
    font-size: 48px;
    color: #dc3545;
    margin-bottom: 20px;
}

.empty-state i {
    color: #adb5bd;
}

.error-state p, .empty-state p {
    font-size: 18px;
    color: #666;
    margin-bottom: 20px;
}

.categories-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 20px;
}

.category-card {
    background: #f8f9fa;
    border-radius: 10px;
    padding: 20px;
    border: 1px solid #e9ecef;
    transition: all 0.3s;
    position: relative;
}

.category-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 25px rgba(0,0,0,0.1);
    border-color: #ffc107;
}

.category-card-header {
    display: flex;
    align-items: center;
    gap: 15px;
    margin-bottom: 15px;
}

.category-icon {
    width: 60px;
    height: 60px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 28px;
    flex-shrink: 0;
}

.category-info {
    flex: 1;
}

.category-name {
    font-size: 18px;
    font-weight: 600;
    color: #333;
    margin-bottom: 5px;
}

.category-type {
    font-size: 14px;
    color: #6c757d;
}

.category-type.system {
    color: #28a745;
    font-weight: 500;
}

.category-type.user {
    color: #17a2b8;
    font-weight: 500;
}

.category-actions {
    display: flex;
    gap: 10px;
    margin-top: 15px;
    padding-top: 15px;
    border-top: 1px solid #e9ecef;
}

.action-btn {
    flex: 1;
    padding: 8px 12px;
    border: none;
    border-radius: 6px;
    font-size: 14px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 5px;
    transition: all 0.2s;
}

.action-btn.edit {
    background: #e7f1ff;
    color: #0d6efd;
}

.action-btn.edit:hover {
    background: #d0e2ff;
}

.action-btn.delete {
    background: #f8d7da;
    color: #dc3545;
}

.action-btn.delete:hover {
    background: #f1b0b7;
}

.action-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.system-badge {
    position: absolute;
    top: 10px;
    right: 10px;
    background: #28a745;
    color: white;
    padding: 4px 10px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 500;
}

@media (max-width: 768px) {
    .category-list-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 15px;
    }
    
    .category-list-filters {
        flex-direction: column;
    }
    
    .search-box, .filter-options select {
        min-width: 100%;
    }
    
    .categories-grid {
        grid-template-columns: 1fr;
    }
}
</style>

<script>
// CategoryList.js - Logique de la liste
class CategoryList {
    constructor(containerId, options = {}) {
        this.container = document.getElementById(containerId);
        this.options = options;
        this.categories = [];
        this.filteredCategories = [];
        this.isLoading = false;
        this.currentFilter = 'all';
        this.searchTerm = '';
        
        this.categoryService = options.categoryService || null;
        this.onEdit = options.onEdit || null;
        this.onDelete = options.onDelete || null;
        this.onAdd = options.onAdd || null;
        
        this.init();
    }
    
    init() {
        this.render();
        this.bindEvents();
        this.loadCategories();
    }
    
    render() {
        this.container.innerHTML = document.querySelector('#category-list-template')?.innerHTML || '';
    }
    
    bindEvents() {
        // Recherche
        const searchInput = this.container.querySelector('#category-search');
        if (searchInput) {
            searchInput.addEventListener('input', (e) => {
                this.searchTerm = e.target.value.toLowerCase();
                this.filterCategories();
            });
        }
        
        // Filtre
        const filterSelect = this.container.querySelector('#category-filter');
        if (filterSelect) {
            filterSelect.addEventListener('change', (e) => {
                this.currentFilter = e.target.value;
                this.filterCategories();
            });
        }
        
        // Bouton d'ajout
        const addBtn = this.container.querySelector('#add-category-btn');
        if (addBtn) {
            addBtn.addEventListener('click', () => {
                if (this.onAdd) this.onAdd();
            });
        }
        
        // Bouton de réessai
        const retryBtn = this.container.querySelector('#retry-btn');
        if (retryBtn) {
            retryBtn.addEventListener('click', () => this.loadCategories());
        }
    }
    
    async loadCategories() {
        if (!this.categoryService) {
            console.error('CategoryService non disponible');
            return;
        }
        
        this.setLoading(true);
        this.hideError();
        this.hideEmpty();
        
        try {
            this.categories = await this.categoryService.fetchCategories();
            this.filterCategories();
        } catch (error) {
            console.error('Erreur chargement catégories:', error);
            this.showError(error.message || 'Erreur de chargement des catégories');
        } finally {
            this.setLoading(false);
        }
    }
    
    filterCategories() {
        let filtered = [...this.categories];
        
        // Appliquer le filtre type
        if (this.currentFilter === 'user') {
            filtered = filtered.filter(cat => cat.type === 1);
        } else if (this.currentFilter === 'system') {
            filtered = filtered.filter(cat => cat.type !== 1);
        }
        
        // Appliquer la recherche
        if (this.searchTerm) {
            filtered = filtered.filter(cat => 
                cat.nom.toLowerCase().includes(this.searchTerm)
            );
        }
        
        this.filteredCategories = filtered;
        this.renderCategories();
    }
    
    renderCategories() {
        const grid = this.container.querySelector('#categories-grid');
        const loading = this.container.querySelector('#loading-state');
        const error = this.container.querySelector('#error-state');
        const empty = this.container.querySelector('#empty-state');
        
        if (!grid) return;
        
        // Cacher tous les états
        if (loading) loading.classList.add('hidden');
        if (error) error.classList.add('hidden');
        if (empty) empty.classList.add('hidden');
        
        // Afficher l'état approprié
        if (this.isLoading) {
            if (loading) loading.classList.remove('hidden');
            grid.innerHTML = '';
            return;
        }
        
        if (this.filteredCategories.length === 0) {
            if (empty) empty.classList.remove('hidden');
            grid.innerHTML = '';
            return;
        }
        
        // Rendre les catégories
        grid.innerHTML = this.filteredCategories.map(category => this.renderCategory(category)).join('');
        
        // Ajouter les événements aux boutons
        this.addCategoryEventListeners();
    }
    
    renderCategory(category) {
        const isUserCategory = category.type === 1;
        const typeText = isUserCategory ? 'Personnelle' : 'Système';
        const typeClass = isUserCategory ? 'user' : 'system';
        
        return `
            <div class="category-card" data-id="${category.id}">
                ${!isUserCategory ? '<span class="system-badge">Système</span>' : ''}
                
                <div class="category-card-header">
                    <div class="category-icon" style="background-color: ${category.color || '#ffc107'}">
                        <i class="material-icons">${category.icon || 'category'}</i>
                    </div>
                    <div class="category-info">
                        <div class="category-name">${this.escapeHtml(category.nom)}</div>
                        <div class="category-type ${typeClass}">${typeText}</div>
                    </div>
                </div>
                
                ${isUserCategory ? `
                <div class="category-actions">
                    <button class="action-btn edit" data-action="edit" data-id="${category.id}">
                        <i class="material-icons">edit</i>
                        Modifier
                    </button>
                    <button class="action-btn delete" data-action="delete" data-id="${category.id}">
                        <i class="material-icons">delete</i>
                        Supprimer
                    </button>
                </div>
                ` : ''}
            </div>
        `;
    }
    
    addCategoryEventListeners() {
        const editBtns = this.container.querySelectorAll('[data-action="edit"]');
        const deleteBtns = this.container.querySelectorAll('[data-action="delete"]');
        
        editBtns.forEach(btn => {
            btn.addEventListener('click', (e) => {
                const id = parseInt(e.target.closest('[data-id]').dataset.id);
                const category = this.categories.find(cat => cat.id === id);
                if (category && this.onEdit) {
                    this.onEdit(category);
                }
            });
        });
        
        deleteBtns.forEach(btn => {
            btn.addEventListener('click', (e) => {
                const id = parseInt(e.target.closest('[data-id]').dataset.id);
                const category = this.categories.find(cat => cat.id === id);
                if (category && this.onDelete) {
                    this.onDelete(category);
                }
            });
        });
    }
    
    setLoading(loading) {
        this.isLoading = loading;
        this.renderCategories();
    }
    
    showError(message) {
        const error = this.container.querySelector('#error-state');
        const errorMessage = this.container.querySelector('#error-message');
        
        if (error) error.classList.remove('hidden');
        if (errorMessage) errorMessage.textContent = message;
    }
    
    hideError() {
        const error = this.container.querySelector('#error-state');
        if (error) error.classList.add('hidden');
    }
    
    hideEmpty() {
        const empty = this.container.querySelector('#empty-state');
        if (empty) empty.classList.add('hidden');
    }
    
    escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }
    
    updateCategories(categories) {
        this.categories = categories;
        this.filterCategories();
    }
    
    destroy() {
        const searchInput = this.container.querySelector('#category-search');
        const filterSelect = this.container.querySelector('#category-filter');
        const addBtn = this.container.querySelector('#add-category-btn');
        const retryBtn = this.container.querySelector('#retry-btn');
        
        if (searchInput) searchInput.removeEventListener('input', this.filterCategories);
        if (filterSelect) filterSelect.removeEventListener('change', this.filterCategories);
        if (addBtn) addBtn.removeEventListener('click', this.onAdd);
        if (retryBtn) retryBtn.removeEventListener('click', this.loadCategories);
        
        this.container.innerHTML = '';
    }
}

// Exporter la classe
if (typeof module !== 'undefined') {
    module.exports = CategoryList;
} else {
    window.CategoryList = CategoryList;
}
</script>